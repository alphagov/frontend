<%
  if defined? @individual_stylesheets
    @individual_stylesheets.add_view("location_form")
  end

  action ||= nil
  results_anchor ||= nil
%>

<div class="postcode-search-form"
  data-module="track-submit"
  data-track-category="postcodeSearch:<%= publication_format %>"
  data-track-action="postcodeSearchStarted">

  <% if @location_error %>
    <%= render "govuk_publishing_components/components/error_summary", {
      id: results_anchor,
      title: t("formats.local_transaction.error_summary_title"),
      data_attributes: {
        module: "govuk-error-summary auto-track-event",
        track_category: "userAlerts: #{publication_format}",
        track_action: "postcodeErrorShown: #{@location_error.postcode_error}",
        track_label: t(@location_error.message, **@location_error.message_args)
      },
      items: [
        {
          text: t(@location_error.message, **@location_error.message_args),
          href: "#postcode"
        }
      ]
    } %>
  <% end %>

  <%= form_with(
    id: "local-locator-form",
    url: action,
    class: "location-form govuk-!-margin-bottom-9",
    method: "post",
  ) do | form | %>

    <%
      #TODO: Add a visually hideen legend option to the fieldset component; then
      #      the component can be used here.
      if defined? @individual_stylesheets
        @individual_stylesheets.add_gem_component("fieldset")
      end
    %>
    <fieldset class="govuk-fieldset">
      <legend class=" govuk-fieldset__legend govuk-visually-hidden"><%= t('formats.local_transaction.postcode_lookup') %></legend>

      <%= render partial: 'draft_fields' %>

      <%= render "govuk_publishing_components/components/input", {
        label: {
          text: t('formats.local_transaction.enter_postcode')
        },
        value: postcode,
        name: "postcode",
        id: "postcode",
        hint: t('formats.local_transaction.postcode_hint'),
        invalid: @location_error ? 'true' : 'false',
        autocomplete: "postal-code",
        error_message: (t(@location_error.message, **@location_error.message_args) if @location_error)
      } %>

      <%= render "govuk_publishing_components/components/button", 
        text: t("find"), 
        margin_bottom: true 
      %>

      <%= tag.p link_to(t('formats.local_transaction.find_postcode_royal_mail'),
        "https://www.royalmail.com/find-a-postcode",
        id: 'postcode-finder-link',
        class: "govuk-link",
        rel: "external"),
        class: "govuk-body"
      %>
    </fieldset>
  <% end %>
</div>

<%= render "govuk_publishing_components/components/action_link", {
  text: "Go to NHS 111 online",
  href: "/page"
} %>

<%= render "govuk_publishing_components/components/attachment", {
  attachment: {
    title: "Department for Transport information asset register",
    url: "https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/747661/department-for-transport-information-asset-register.csv",
    filename: "department-for-transport-information-asset-register.csv",
    content_type: "text/csv",
    file_size: 20000
  }
} %>

<%= render "govuk_publishing_components/components/back_link", {
  href: "#"
} %>

<%= render "govuk_publishing_components/components/big_number", {
  number: 119
} %>

<%= render "govuk_publishing_components/components/contents_list", {
  contents: [
    {
      href: "#first-thing",
      text: "First thing"
    },
    {
      href: "#second-thing",
      text: "Second thing"
    },
    {
      href: "#third-thing",
      text: "Third thing"
    }
  ]
} %>

<%= render "govuk_publishing_components/components/contextual_breadcrumbs", {
  content_item: {
    title: "A content item"
  }
} %>

<%= render "govuk_publishing_components/components/contextual_footer", {
  content_item: {
    title: "A content item",
    links: {
      topics: [
        {
          title: "Apprenticeships, 14 to 19 education and training for work",
          base_path: "/browse/education/find-course",
          document_type: "topic"
        },
        {
          title: "Finding a job",
          base_path: "/browse/working/finding-job",
          document_type: "topic"
        },
        {
          title: "Apprenticeships",
          base_path: "/topic/further-education-skills/apprenticeships",
          document_type: "topic"
        }
      ],
      topical_events: [
        {
          title: "UK-China High-Level People to People Dialogue 2017",
          base_path: "/government/topical-events/uk-china-high-level-people-to-people-dialogue-2017",
          document_type: "topical_event"
        }
      ],
      related: [
        {
          title: "Pest Control",
          base_path: "/pest-control",
          document_type: "contact"
        }
      ],
      related_statistical_data_sets: [
        {
          title: "International road fuel prices",
          base_path: "/government/statistical-data-sets/comparisons-of-industrial-and-domestic-energy-prices-monthly-figures",
          document_type: "statistical_data_set"
        },
        {
          title: "Weekly road fuel prices",
          base_path: "/government/statistical-data-sets/oil-and-petroleum-products-weekly-statistics",
          document_type: "statistical_data_set"
        }
      ],
      world_locations: [
        {
          title: "South Sudan",
          base_path: "/world/south-sudan/news"
        },
        {
          title: "USA",
          base_path: "/world/usa/news"
        }
      ]
    },
    details: {
      external_related_links: [
        {
          url: "http://media.slc.co.uk/sfe/1718/ft/sfe_terms_and_conditions_guide_1718_d.pdf",
          title: "Student loans: terms and conditions 2017 to 2018 (PDF, 136KB)"
        },
        {
          title: "The Student Room repaying your student loan",
          url: "https://www.thestudentroom.co.uk/content.php?r=5967-Repaying-your-student-loan"
        }
      ]
    }
  }
} %>

<%= render "govuk_publishing_components/components/contextual_guidance", {
  html_for: "news-title",
  title: "Writing a news title",
  guidance_id: "news-title-guidance",
  content: sanitize("<p>The title must make clear what the content offers users. Use the words your users do to help them find this. Avoid wordplay or teases.</p>
    ")
} do %>
  <div class="govuk-form-group">
  <label class="gem-c-label govuk-label" for="news-title">News title</label>
  <input id="news-title" type="text" class="gem-c-input govuk-input" aria-describedby="news-title-guidance">
</div>
<% end %>

<%= render "govuk_publishing_components/components/contextual_sidebar", {
  content_item: {
    title: "A content item",
    links: {
      ordered_related_items: [
        {
          title: "Find an apprenticeship",
          base_path: "/apply-apprenticeship"
        },
        {
          title: "Training and study at work",
          base_path: "/training-study-work-your-rights"
        },
        {
          title: "Careers helpline for teenagers",
          base_path: "/careers-helpline-for-teenagers"
        }
      ],
      document_collections: [
        {
          title: "Recruit an apprentice (formerly apprenticeship vacancies)",
          base_path: "/government/collections/apprenticeship-vacancies",
          document_type: "document_collection"
        },
        {
          title: "The future of jobs and skills",
          base_path: "/government/collections/the-future-of-jobs-and-skills",
          document_type: "document_collection"
        }
      ]
    }
  }
} %>

<%= render "govuk_publishing_components/components/copy_to_clipboard", {
  label: "Copy and send this link to someone and they’ll be able to preview your draft on GOV.UK.",
  copyable_content: "http://www.example.org",
  button_text: "Copy link"
} %>

<%= render "govuk_publishing_components/components/details", {
  title: "Help with nationality"
} do %>
  We need to know your nationality so we can work out which elections you’re entitled to vote in. If you can’t provide your nationality, you’ll have to send copies of identity documents through the post.
<% end %>

<%= render "govuk_publishing_components/components/file_upload", {
  label: {
    text: "Upload a file"
  },
  name: "file-upload"
} %>

<%= render "govuk_publishing_components/components/reorderable_list", {
  items: [
    {
      id: "ce99dd60-67dc-11eb-ae93-0242ac130002",
      title: "Budget 2018"
    },
    {
      id: "d321cb86-67dc-11eb-ae93-0242ac130002",
      title: "Budget 2018 (web)"
    },
    {
      id: "63a6d29e-6b6d-4157-9067-84c1a390e352",
      title: "Impact on households: distributional analysis to accompany Budget 2018"
    },
    {
      id: "0a4d377d-68f4-472f-b2e3-ef71dc750f85",
      title: "Table 2.1: Budget 2018 policy decisions"
    },
    {
      id: "5ebd75d7-6c37-4b93-b444-1b7c49757fb9",
      title: "Table 2.2: Measures announced at Autumn Budget 2017 or earlier that will take effect from November 2018 or later (£ million)"
    }
  ]
} %>

<%= render "govuk_publishing_components/components/table", {
  rows: [
    [
      {
        text: "January"
      },
      {
        text: "£85",
        format: "numeric"
      },
      {
        text: "£95",
        format: "numeric"
      }
    ],
    [
      {
        text: "February"
      },
      {
        text: "£75",
        format: "numeric"
      },
      {
        text: "£55",
        format: "numeric"
      }
    ],
    [
      {
        text: "March"
      },
      {
        text: "£165",
        format: "numeric"
      },
      {
        text: "£125",
        format: "numeric"
      }
    ]
  ]
} %>

<%= render "govuk_publishing_components/components/govspeak", {
} do %>
  <p>An attachment as a block</p>

<%= render "govuk_publishing_components/components/attachment",
    attachment: { url: "https://example.com/file.odt",
                  title: "Attachment",
                  file_size: 1024,
                  content_type: "application/vnd.oasis.opendocument.text" }
%>
<% end %>
